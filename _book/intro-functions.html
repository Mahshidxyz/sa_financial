<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A short course on Survival Analysis applied to the Financial Industry</title>
  <meta name="description" content="This is a short course on survival analysis applied to the financial field.">
  <meta name="generator" content="bookdown 0.5.4 and GitBook 2.6.7">

  <meta property="og:title" content="A short course on Survival Analysis applied to the Financial Industry" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a short course on survival analysis applied to the financial field." />
  <meta name="github-repo" content="sestelo/sa_financial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A short course on Survival Analysis applied to the Financial Industry" />
  
  <meta name="twitter:description" content="This is a short course on survival analysis applied to the financial field." />
  

<meta name="author" content="Marta Sestelo">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro-notation.html">
<link rel="next" href="relation-between-functions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">A short course on Survival Analysis</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="programing-language-and-software.html"><a href="programing-language-and-software.html"><i class="fa fa-check"></i>Programing language and software</a></li>
<li class="chapter" data-level="" data-path="main-references-and-credits.html"><a href="main-references-and-credits.html"><i class="fa fa-check"></i>Main references and credits</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-what.html"><a href="intro-what.html"><i class="fa fa-check"></i><b>1.1</b> What is survival analysis?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro-what.html"><a href="intro-what.html#time-time-origen-time-scale-event"><i class="fa fa-check"></i><b>1.1.1</b> Time, time origen, time scale, event</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro-what.html"><a href="intro-what.html#goals-of-the-survival-analysis"><i class="fa fa-check"></i><b>1.1.2</b> Goals of the survival analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro-censor.html"><a href="intro-censor.html"><i class="fa fa-check"></i><b>1.2</b> Censoring</a></li>
<li class="chapter" data-level="1.3" data-path="intro-notation.html"><a href="intro-notation.html"><i class="fa fa-check"></i><b>1.3</b> Some notation</a></li>
<li class="chapter" data-level="1.4" data-path="intro-functions.html"><a href="intro-functions.html"><i class="fa fa-check"></i><b>1.4</b> Survival/hazard functions</a></li>
<li class="chapter" data-level="1.5" data-path="relation-between-functions.html"><a href="relation-between-functions.html"><i class="fa fa-check"></i><b>1.5</b> Relation between functions</a></li>
<li class="chapter" data-level="1.6" data-path="intro-distri.html"><a href="intro-distri.html"><i class="fa fa-check"></i><b>1.6</b> Some common distributions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="km.html"><a href="km.html"><i class="fa fa-check"></i><b>2</b> Kaplan Meier estimator</a><ul>
<li class="chapter" data-level="2.1" data-path="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><a href="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><i class="fa fa-check"></i><b>2.1</b> Estimating survival by means of the Kaplan Meier estimator</a><ul>
<li class="chapter" data-level="2.1.1" data-path="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><a href="estimating-survival-by-means-of-the-kaplan-meier-estimator.html#other-representation"><i class="fa fa-check"></i><b>2.1.1</b> Other representation</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="pointwise-confidence-interval-for-st.html"><a href="pointwise-confidence-interval-for-st.html"><i class="fa fa-check"></i><b>2.2</b> Pointwise confidence interval for <span class="math inline">\(S(t)\)</span></a></li>
<li class="chapter" data-level="2.3" data-path="comparing-survival-curves.html"><a href="comparing-survival-curves.html"><i class="fa fa-check"></i><b>2.3</b> Comparing survival curves</a></li>
<li class="chapter" data-level="2.4" data-path="pros-and-cons-of-the-kaplan-meirs-estimator.html"><a href="pros-and-cons-of-the-kaplan-meirs-estimator.html"><i class="fa fa-check"></i><b>2.4</b> Pros and Cons of the Kaplan-Meirs estimator</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cox.html"><a href="cox.html"><i class="fa fa-check"></i><b>3</b> The Cox Proportional Hazards Model</a><ul>
<li class="chapter" data-level="3.1" data-path="the-semiparametric-model.html"><a href="the-semiparametric-model.html"><i class="fa fa-check"></i><b>3.1</b> The semiparametric model</a></li>
<li class="chapter" data-level="3.2" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>3.2</b> Estimation</a></li>
<li class="chapter" data-level="3.3" data-path="computing-the-hazard-ratio.html"><a href="computing-the-hazard-ratio.html"><i class="fa fa-check"></i><b>3.3</b> Computing the Hazard Ratio</a></li>
<li class="chapter" data-level="3.4" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html"><i class="fa fa-check"></i><b>3.4</b> Hypothesis testing</a></li>
<li class="chapter" data-level="3.5" data-path="adjusting-survival-curves.html"><a href="adjusting-survival-curves.html"><i class="fa fa-check"></i><b>3.5</b> Adjusting Survival Curves</a></li>
<li class="chapter" data-level="3.6" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html"><i class="fa fa-check"></i><b>3.6</b> How to evaluate the PH assumption?</a><ul>
<li class="chapter" data-level="3.6.1" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html#graphical-approach"><i class="fa fa-check"></i><b>3.6.1</b> Graphical approach</a></li>
<li class="chapter" data-level="3.6.2" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html#goodness-of-fit-test"><i class="fa fa-check"></i><b>3.6.2</b> Goodness-of-fit test</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="non-proportional-hazards-and-now-what.html"><a href="non-proportional-hazards-and-now-what.html"><i class="fa fa-check"></i><b>3.7</b> Non-Proportional Hazardsâ€¦ and now what?</a><ul>
<li class="chapter" data-level="3.7.1" data-path="non-proportional-hazards-and-now-what.html"><a href="non-proportional-hazards-and-now-what.html#an-example-stratified-proportional-hazards-models"><i class="fa fa-check"></i><b>3.7.1</b> An exampleâ€¦ Stratified Proportional Hazards Models</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="why-cox-ph-model-is-so-popular-pros-of-the-model.html"><a href="why-cox-ph-model-is-so-popular-pros-of-the-model.html"><i class="fa fa-check"></i><b>3.8</b> Why Cox PH model is so popular? (pros of the model)</a></li>
<li class="chapter" data-level="3.9" data-path="bonus-track-1-additive-cox-model.html"><a href="bonus-track-1-additive-cox-model.html"><i class="fa fa-check"></i><b>3.9</b> Bonus track 1: Additive Cox model</a></li>
<li class="chapter" data-level="3.10" data-path="bonus-track-2-machine-learning-for-estimating-the-cox-pm-model.html"><a href="bonus-track-2-machine-learning-for-estimating-the-cox-pm-model.html"><i class="fa fa-check"></i><b>3.10</b> Bonus track 2: Machine Learning for estimating the Cox PM model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="joint-models-for-longitudinal-and-time-to-event-data.html"><a href="joint-models-for-longitudinal-and-time-to-event-data.html"><i class="fa fa-check"></i><b>4</b> Joint Models for Longitudinal and Time-to-Event Data</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>4.1</b> Linear Mixed Models</a></li>
<li class="chapter" data-level="4.2" data-path="estimation-of-the-joint-model.html"><a href="estimation-of-the-joint-model.html"><i class="fa fa-check"></i><b>4.2</b> Estimation of the Joint Model</a></li>
<li class="chapter" data-level="4.3" data-path="the-jm-package.html"><a href="the-jm-package.html"><i class="fa fa-check"></i><b>4.3</b> The <code>JM</code> package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="condsurv.html"><a href="condsurv.html"><i class="fa fa-check"></i><b>5</b> Conditinal Survival with <code>condSURV</code></a><ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="notation.html"><a href="notation.html"><i class="fa fa-check"></i><b>5.2</b> Notation</a></li>
<li class="chapter" data-level="5.3" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html"><i class="fa fa-check"></i><b>5.3</b> Estimation of the conditional survival</a><ul>
<li class="chapter" data-level="5.3.1" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#kaplan-meier-weighted-estimator-kmw"><i class="fa fa-check"></i><b>5.3.1</b> Kaplan-Meier Weighted Estimator (<code>KMW</code>)</a></li>
<li class="chapter" data-level="5.3.2" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#the-landmark-approach-ldm"><i class="fa fa-check"></i><b>5.3.2</b> The Landmark approach (<code>LDM</code>)</a></li>
<li class="chapter" data-level="5.3.3" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#the-presmoothed-landmark-approach-pldm"><i class="fa fa-check"></i><b>5.3.3</b> The Presmoothed Landmark approach (<code>PLDM</code>)</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-condsurv-package.html"><a href="the-condsurv-package.html"><i class="fa fa-check"></i><b>5.4</b> The <code>condSURV</code> package</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-install.html"><a href="appendix-install.html"><i class="fa fa-check"></i><b>A</b> Installation of <code>R</code> and <code>RStudio</code></a></li>
<li class="chapter" data-level="B" data-path="appendix-rstudio.html"><a href="appendix-rstudio.html"><i class="fa fa-check"></i><b>B</b> Introduction to <code>RStudio</code></a></li>
<li class="chapter" data-level="C" data-path="appendix-r.html"><a href="appendix-r.html"><i class="fa fa-check"></i><b>C</b> Introduction to <code>R</code></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A short course on Survival Analysis applied to the Financial Industry</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro-functions" class="section level2">
<h2><span class="header-section-number">1.4</span> Survival/hazard functions</h2>
<p>Assuming that <span class="math inline">\(T\)</span> is a continuous non-negative random variable which denote the time-to-event. There is a certain probability that an individual will have an event at exactly time <span class="math inline">\(t\)</span>. For example, about human longevity, human beings have a certain probability of dying at ages <span class="math inline">\(2\)</span>, <span class="math inline">\(20\)</span>, <span class="math inline">\(80\)</span>, and <span class="math inline">\(140\)</span>, that could be: <span class="math inline">\(P(T=2)\)</span>, <span class="math inline">\(P(T=20)\)</span>, <span class="math inline">\(P(T=80)\)</span> and <span class="math inline">\(P(T=140)\)</span>.</p>
<p>Similarly, human beings have a certain probability of being alive at those same ages: <span class="math inline">\(P(T&gt;2)\)</span>, <span class="math inline">\(P(T&gt;20)\)</span>, <span class="math inline">\(P(T&gt;80)\)</span>, and <span class="math inline">\(P(T&gt;140)\)</span>.</p>
<p>Here an example with same real data:<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/deaths_esp.txt&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
data &lt;-<span class="st"> </span>data[<span class="op">!</span>data<span class="op">$</span>Age <span class="op">==</span><span class="st"> &quot;110+&quot;</span>, ] <span class="co"># to avoid errors</span>
data<span class="op">$</span>Age_cut &lt;-<span class="st"> </span><span class="kw">cut</span>(<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(data<span class="op">$</span>Age)), 
                 <span class="dt">breaks =</span>  <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">110</span>, <span class="dv">10</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>)

by_age &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Age_cut)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span> (<span class="dt">sum_deaths =</span> <span class="kw">sum</span>(Total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))

<span class="kw">barplot</span>(by_age<span class="op">$</span>sum_deaths<span class="op">/</span><span class="kw">sum</span>(data<span class="op">$</span>Total), <span class="dt">names.arg =</span> by_age<span class="op">$</span>Age_cut, <span class="dt">ylab=</span> <span class="st">&quot;Relative frequency&quot;</span>) </code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="bookdown_files/figure-html/unnamed-chunk-6-1.png" alt="Relative frequiencies for grouped ages." width="672" />
<p class="caption">
Figure 1.2: Relative frequiencies for grouped ages.
</p>
</div>
<!-- ggplot(data = by_age) + -->
<!--   geom_bar(mapping = aes(x = Age_cut, y = sum_deaths/data$Total), stat = "identity") -->
<p>In the case of human longevity, the probability of death is higher at the beginning and end of life (in Spain). Therefore, <span class="math inline">\(T\)</span> is unlikely to follow a normal distribution. We can see a higher chance of dying (the event of interest) in their 70â€™s and 80â€™s and smaller chance of dying in their 100â€™s and 110â€™s, because few people make it long enough to die at these age.</p>
<p>The function that gives the probability of the failure time occurring at exactly time <span class="math inline">\(t\)</span> is the <strong>density function <span class="math inline">\(f(t)\)</span></strong><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<p><span class="math display">\[
f(t) = \displaystyle{lim_{\Delta_t \to 0}} \frac{P(t \le T &lt; t + \Delta t)}{\Delta t}
\]</span> and the function that gives the probability of the failure time occur before or exactly at time <span class="math inline">\(t\)</span> is the <strong>cumulative distribution function <span class="math inline">\(F(t)\)</span></strong></p>
<p><span class="math display">\[
F(t) = P(T \le t) = \int_{0}^{t} f(u) du.
\]</span></p>
<p>Note that <span class="math inline">\(F(t)\)</span> is more interesting than <span class="math inline">\(f(t)\)</span>â€¦ And why? Well, as we said, the main goal of survival analysis is to estimate and compare survival experiences of different groups and the survival experience is described by the <strong>survival function <span class="math inline">\(S(t)\)</span></strong></p>
<p><span class="math display">\[
S(t) = P(T &gt; t) = 1 - F(t)
\]</span></p>
<p>The survival function gives the probability that a person survives longer than some specified time <span class="math inline">\(t\)</span>: that is, <span class="math inline">\(S(t)\)</span> gives the probability that the random variable <span class="math inline">\(T\)</span> exceeds the specified time <span class="math inline">\(t\)</span>. And here, some important characteristics:</p>
<ul>
<li><p>It is nonincreasing; that is, it heads downward as <span class="math inline">\(t\)</span> increases.</p></li>
<li><p>At time <span class="math inline">\(t = 0\)</span>, <span class="math inline">\(S(t) = S(0)= 1\)</span>; that is, at the start of the study, since no one has gotten the event yet, the probability of surviving past time zero is one.</p></li>
<li><p>At time <span class="math inline">\(t = \inf\)</span>, <span class="math inline">\(S(t) = S(\inf) = 0\)</span>; that is, theoretically, if the study period increased without limit, eventually nobody would survive, so the survival curve must eventually fall to zero.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">1</span>)
tdf &lt;-<span class="st"> </span><span class="kw">pweibull</span>(t, <span class="dt">scale =</span> <span class="dv">80</span>, <span class="dt">shape =</span> <span class="dv">5</span>) <span class="co"># weibull dist</span>

d &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> t, <span class="dt">dist =</span> tdf, <span class="dt">surv =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tdf), <span class="dt">id =</span> <span class="st">&quot;x&quot;</span>)
<span class="kw">qplot</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> value, <span class="dt">col =</span> variable, <span class="dt">data =</span> d, <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, 
      <span class="dt">ylab =</span> <span class="st">&quot;probability&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">labels=</span> <span class="kw">c</span>(<span class="st">&quot;F(t)&quot;</span>, <span class="st">&quot;S(t)&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;&quot;</span>) </code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Note that these are theoretical properties of survival curves. In practice, when using actual data, we usually obtain graphs that are step functions, rather than smooth curves. Moreover, because the study period is never infinite in length and there may be competing risks for failure, it is possible that not everyone studied gets the event. The estimated survival function, <span class="math inline">\(\hat{S}(t)\)</span> thus may not go all the way down to zero at the end of the study.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_age &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Age)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span> (<span class="dt">sum_deaths =</span> <span class="kw">sum</span>(Total, <span class="dt">na.rm =</span> T))
t &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(by_age<span class="op">$</span>Age)), by_age<span class="op">$</span>sum_deaths) <span class="co"># real times</span>

aux &lt;-<span class="st"> </span><span class="kw">ecdf</span>(t)
x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">1</span>)
edf &lt;-<span class="st"> </span><span class="kw">aux</span>(x) <span class="co"># evaluating the ecdf in some points</span>
esf &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="st"> </span>edf

d &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">dist =</span> edf, <span class="dt">surv =</span> esf), <span class="dt">id =</span> <span class="st">&quot;x&quot;</span>)
<span class="kw">qplot</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> value, <span class="dt">col =</span> variable, <span class="dt">data =</span> d, <span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>, 
      <span class="dt">ylab =</span> <span class="st">&quot;Probability&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;t&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_discrete</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;F(t)&quot;</span>, <span class="st">&quot;S(t)&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<!-- ```{r} -->
<!-- #t <- sort(runif(30, 0, 7)) -->
<!-- #t <- seq(0, 7, length.out = 100) -->
<!-- t <- sort(rweibull(500, scale = 80, shape = 5)) -->
<!-- edf <- ecdf(t) -->
<!-- edf2 <- edf(t) -->
<!-- plot(t, edf2, type = "s", ylab = "Probability", xlab = "t") -->
<!-- lines(t, 1 - edf2, type = "s", ylab = "Probability", xlab = "t", col = 2) -->
<!-- legend("right", c("F(t)", "S(t)"), col = c(1,2), lwd = c(1, 1)) -->
<!-- ```  -->
<p>The <strong>hazard function <span class="math inline">\(h(t)\)</span></strong>, is given by the formula:</p>
<p><span class="math display">\[
h(t) = \displaystyle{lim_{\Delta_t \to 0}} \frac{P(t \le T &lt; t + \Delta t | T \ge t)}{\Delta t}
\]</span> This mathematical formula is difficult to explain in practical terms. We could say that the hazard function is the probability that if you survive to time <span class="math inline">\(t\)</span>, you will experience the event in the next instant, or in other words, the hazard function gives the instantaneous potential per unit time for the event to occur, given that the individual has survived up to time <span class="math inline">\(t\)</span>. Because of the given sign here, the hazard function is sometimes called a <strong>conditional failure rate</strong>.</p>
<p>Note that, in contrast to the <strong>survival function</strong>, which focuses on <strong>not failing</strong>, the <strong>hazard function</strong> focuses on <strong>failing</strong>, that is, on the event occurring. Thus, in some sense, the hazard function can be considered as giving the opposite side of the information given by the survivor function.</p>
<p>Additionally, in contrast to a survival function, the graph of <span class="math inline">\(h(t)\)</span> does not have to start at one and go down to zero, but rather can start anywhere and go up and down in any direction over time. In particular, for a specified value of <span class="math inline">\(t\)</span>, the hazard function <span class="math inline">\(h(t)\)</span> has the following characteristics:</p>
<ul>
<li><p>It is always nonnegative, that is, equal to or greater than zero.</p></li>
<li><p>It has no upper bound.</p></li>
</ul>
<p>Finally note that the hazard function can be expressed as the probability density function divided by the survival function, <span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span>:</p>
<p><span class="math display">\[
P(t \le T \lt t + dt | T \ge t) = \frac{P(t \le T \lt t + dt, T \ge t)}{P(T \ge t)} = \frac{P(t \le T \lt t + dt)}{P(T \ge t)}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h &lt;-<span class="st"> </span><span class="kw">hist</span>(t, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
x &lt;-<span class="st"> </span>h<span class="op">$</span>mids
dens &lt;-<span class="st"> </span>h<span class="op">$</span>density
surv &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">aux</span>(x)
hazard &lt;-<span class="st"> </span>dens<span class="op">/</span>surv
<span class="kw">qplot</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> hazard, <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Conditional probability of death&quot;</span>,
      <span class="dt">xlab =</span> <span class="st">&quot;Age&quot;</span>)</code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<!-- In the shiny application below you can see some examples of hazard functions: -->
<!--  TODO shiny with several hazard: exponential, increasing weibull, decresing weibull, lognormal -->
<!-- ```{r} -->
<!-- x <- seq(0, 5, 0.01) -->
<!-- den <- dexp(x, 1) -->
<!-- surv <- 1 - pexp(x, 1) -->
<!-- plot(x, den/surv, type = "l", ylim = c(0.5,1.5), ylab = "Hazard", xlab = "t") -->
<!-- ``` -->
<p>In some cases it can be more interesting to present the cumulative hazard. It will be <span class="math inline">\(H(t) = \int_{0}^{t} h(u) du\)</span>.</p>

<div class="rmdhint_sestelo">
<p><strong>Hazard vs.Â density function</strong></p>
According to the human longevity study, note that when you are born, you have a certain probability of dying at any age, that will be <span class="math inline">\(P(T = t)\)</span>, i.e.Â the density function. A woman born today has, say, a 1% chance of dying at 80 years. However, as you survive for a while, your probabilities keep changing, and these new conditional probabilities are given by the hazard function. In such case, we have a woman who is 79 today and has, say, a 7% chance of dying at 80 years.
</div>

</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Data from <em>The Human Mortality Database</em> at <a href="http://www.mortality.org" class="uri">http://www.mortality.org</a>.<a href="intro-functions.html#fnref1">â†©</a></p></li>
<li id="fn2"><p>The probability mass function is a function that gives the probability that a discrete random variable is exactly equal to some value.<a href="intro-functions.html#fnref2">â†©</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-notation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="relation-between-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sestelo/sa_financial/edit/master/02_intro.Rmd",
"text": "Edit"
},
"download": ["bookdown.epub", "bookdown.mobi"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
