<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A short course on Survival Analysis applied to the Financial Industry</title>
  <meta name="description" content="This is a short course on survival analysis applied to the financial field.">
  <meta name="generator" content="bookdown 0.5.4 and GitBook 2.6.7">

  <meta property="og:title" content="A short course on Survival Analysis applied to the Financial Industry" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a short course on survival analysis applied to the financial field." />
  <meta name="github-repo" content="sestelo/sa_financial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A short course on Survival Analysis applied to the Financial Industry" />
  
  <meta name="twitter:description" content="This is a short course on survival analysis applied to the financial field." />
  

<meta name="author" content="Marta Sestelo">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="the-semiparametric-model.html">
<link rel="next" href="computing-the-hazard-ratio.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">A short course on Survival Analysis</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="programing-language-and-software.html"><a href="programing-language-and-software.html"><i class="fa fa-check"></i>Programing language and software</a></li>
<li class="chapter" data-level="" data-path="main-references-and-credits.html"><a href="main-references-and-credits.html"><i class="fa fa-check"></i>Main references and credits</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-what.html"><a href="intro-what.html"><i class="fa fa-check"></i><b>1.1</b> What is survival analysis?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro-what.html"><a href="intro-what.html#time-time-origen-time-scale-event"><i class="fa fa-check"></i><b>1.1.1</b> Time, time origen, time scale, event</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro-what.html"><a href="intro-what.html#goals-of-the-survival-analysis"><i class="fa fa-check"></i><b>1.1.2</b> Goals of the survival analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro-censor.html"><a href="intro-censor.html"><i class="fa fa-check"></i><b>1.2</b> Censoring</a></li>
<li class="chapter" data-level="1.3" data-path="intro-notation.html"><a href="intro-notation.html"><i class="fa fa-check"></i><b>1.3</b> Some notation</a></li>
<li class="chapter" data-level="1.4" data-path="intro-functions.html"><a href="intro-functions.html"><i class="fa fa-check"></i><b>1.4</b> Survival/hazard functions</a></li>
<li class="chapter" data-level="1.5" data-path="relation-between-functions.html"><a href="relation-between-functions.html"><i class="fa fa-check"></i><b>1.5</b> Relation between functions</a></li>
<li class="chapter" data-level="1.6" data-path="intro-distri.html"><a href="intro-distri.html"><i class="fa fa-check"></i><b>1.6</b> Some common distributions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="km.html"><a href="km.html"><i class="fa fa-check"></i><b>2</b> Kaplan Meier estimator</a><ul>
<li class="chapter" data-level="2.1" data-path="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><a href="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><i class="fa fa-check"></i><b>2.1</b> Estimating survival by means of the Kaplan Meier estimator</a><ul>
<li class="chapter" data-level="2.1.1" data-path="estimating-survival-by-means-of-the-kaplan-meier-estimator.html"><a href="estimating-survival-by-means-of-the-kaplan-meier-estimator.html#other-representation"><i class="fa fa-check"></i><b>2.1.1</b> Other representation</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="pointwise-confidence-interval-for-st.html"><a href="pointwise-confidence-interval-for-st.html"><i class="fa fa-check"></i><b>2.2</b> Pointwise confidence interval for <span class="math inline">\(S(t)\)</span></a></li>
<li class="chapter" data-level="2.3" data-path="comparing-survival-curves.html"><a href="comparing-survival-curves.html"><i class="fa fa-check"></i><b>2.3</b> Comparing survival curves</a></li>
<li class="chapter" data-level="2.4" data-path="pros-and-cons-of-the-kaplan-meirs-estimator.html"><a href="pros-and-cons-of-the-kaplan-meirs-estimator.html"><i class="fa fa-check"></i><b>2.4</b> Pros and Cons of the Kaplan-Meirs estimator</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cox.html"><a href="cox.html"><i class="fa fa-check"></i><b>3</b> The Cox Proportional Hazards Model</a><ul>
<li class="chapter" data-level="3.1" data-path="the-semiparametric-model.html"><a href="the-semiparametric-model.html"><i class="fa fa-check"></i><b>3.1</b> The semiparametric model</a></li>
<li class="chapter" data-level="3.2" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>3.2</b> Estimation</a></li>
<li class="chapter" data-level="3.3" data-path="computing-the-hazard-ratio.html"><a href="computing-the-hazard-ratio.html"><i class="fa fa-check"></i><b>3.3</b> Computing the Hazard Ratio</a></li>
<li class="chapter" data-level="3.4" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html"><i class="fa fa-check"></i><b>3.4</b> Hypothesis testing</a></li>
<li class="chapter" data-level="3.5" data-path="adjusting-survival-curves.html"><a href="adjusting-survival-curves.html"><i class="fa fa-check"></i><b>3.5</b> Adjusting Survival Curves</a></li>
<li class="chapter" data-level="3.6" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html"><i class="fa fa-check"></i><b>3.6</b> How to evaluate the PH assumption?</a><ul>
<li class="chapter" data-level="3.6.1" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html#graphical-approach"><i class="fa fa-check"></i><b>3.6.1</b> Graphical approach</a></li>
<li class="chapter" data-level="3.6.2" data-path="how-to-evaluate-the-ph-assumption.html"><a href="how-to-evaluate-the-ph-assumption.html#goodness-of-fit-test"><i class="fa fa-check"></i><b>3.6.2</b> Goodness-of-fit test</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="non-proportional-hazards-and-now-what.html"><a href="non-proportional-hazards-and-now-what.html"><i class="fa fa-check"></i><b>3.7</b> Non-Proportional Hazards… and now what?</a><ul>
<li class="chapter" data-level="3.7.1" data-path="non-proportional-hazards-and-now-what.html"><a href="non-proportional-hazards-and-now-what.html#an-example-stratified-proportional-hazards-models"><i class="fa fa-check"></i><b>3.7.1</b> An example… Stratified Proportional Hazards Models</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="why-cox-ph-model-is-so-popular-pros-of-the-model.html"><a href="why-cox-ph-model-is-so-popular-pros-of-the-model.html"><i class="fa fa-check"></i><b>3.8</b> Why Cox PH model is so popular? (pros of the model)</a></li>
<li class="chapter" data-level="3.9" data-path="bonus-track-1-additive-cox-model.html"><a href="bonus-track-1-additive-cox-model.html"><i class="fa fa-check"></i><b>3.9</b> Bonus track 1: Additive Cox model</a></li>
<li class="chapter" data-level="3.10" data-path="bonus-track-2-machine-learning-for-estimating-the-cox-pm-model.html"><a href="bonus-track-2-machine-learning-for-estimating-the-cox-pm-model.html"><i class="fa fa-check"></i><b>3.10</b> Bonus track 2: Machine Learning for estimating the Cox PM model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="joint-models-for-longitudinal-and-time-to-event-data.html"><a href="joint-models-for-longitudinal-and-time-to-event-data.html"><i class="fa fa-check"></i><b>4</b> Joint Models for Longitudinal and Time-to-Event Data</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>4.1</b> Linear Mixed Models</a></li>
<li class="chapter" data-level="4.2" data-path="estimation-of-the-joint-model.html"><a href="estimation-of-the-joint-model.html"><i class="fa fa-check"></i><b>4.2</b> Estimation of the Joint Model</a></li>
<li class="chapter" data-level="4.3" data-path="the-jm-package.html"><a href="the-jm-package.html"><i class="fa fa-check"></i><b>4.3</b> The <code>JM</code> package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="condsurv.html"><a href="condsurv.html"><i class="fa fa-check"></i><b>5</b> Conditinal Survival with <code>condSURV</code></a><ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="notation.html"><a href="notation.html"><i class="fa fa-check"></i><b>5.2</b> Notation</a></li>
<li class="chapter" data-level="5.3" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html"><i class="fa fa-check"></i><b>5.3</b> Estimation of the conditional survival</a><ul>
<li class="chapter" data-level="5.3.1" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#kaplan-meier-weighted-estimator-kmw"><i class="fa fa-check"></i><b>5.3.1</b> Kaplan-Meier Weighted Estimator (<code>KMW</code>)</a></li>
<li class="chapter" data-level="5.3.2" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#the-landmark-approach-ldm"><i class="fa fa-check"></i><b>5.3.2</b> The Landmark approach (<code>LDM</code>)</a></li>
<li class="chapter" data-level="5.3.3" data-path="estimation-of-the-conditional-survival.html"><a href="estimation-of-the-conditional-survival.html#the-presmoothed-landmark-approach-pldm"><i class="fa fa-check"></i><b>5.3.3</b> The Presmoothed Landmark approach (<code>PLDM</code>)</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-condsurv-package.html"><a href="the-condsurv-package.html"><i class="fa fa-check"></i><b>5.4</b> The <code>condSURV</code> package</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-install.html"><a href="appendix-install.html"><i class="fa fa-check"></i><b>A</b> Installation of <code>R</code> and <code>RStudio</code></a></li>
<li class="chapter" data-level="B" data-path="appendix-rstudio.html"><a href="appendix-rstudio.html"><i class="fa fa-check"></i><b>B</b> Introduction to <code>RStudio</code></a></li>
<li class="chapter" data-level="C" data-path="appendix-r.html"><a href="appendix-r.html"><i class="fa fa-check"></i><b>C</b> Introduction to <code>R</code></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A short course on Survival Analysis applied to the Financial Industry</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimation" class="section level2">
<h2><span class="header-section-number">3.2</span> Estimation</h2>
<p>The estimation of the model is obtained by <strong>Maximun Likelihood</strong>, particularly maximazing the <strong>“partial” likelihood function</strong> rather than a (complete) likelihood function. The term “partial” likelihood is used because the likelihood formula considers probabilities only for those subjects who fail, and does not explicitly consider probabilities for those subjects who are censored. The “partial” likekihood is given by:</p>
<p><span class="math display">\[
L(\boldsymbol \beta) = \prod_{i:\Delta_i = 1} \frac{\exp\bigg[ \sum_{j=1}^{p}\beta_j X_{(i)j} \bigg]}{\sum_{k \in R(t_i)} \exp \bigg[ \sum_{j=1}^{p}\beta_j X_{(k)j} \bigg]}
\]</span> being <span class="math inline">\(t_1 &lt; t_2 &lt; \ldots &lt; t_D\)</span> the ordered event times, <span class="math inline">\(Z_{(i)j}\)</span> the <span class="math inline">\(j\)</span>-th covariate associated with the individual whose failure time is <span class="math inline">\(t_i\)</span> and <span class="math inline">\(R(t_i)\)</span> the risk set at time <span class="math inline">\(t_i\)</span>, that is, the the set of all individuals who are still under study at a time just prior to <span class="math inline">\(t_i\)</span>.</p>
<p>Note that the numerator of the likelihood depends only on information from the individual who experiences the event, whereas the denominator uses information about all individuals who have not yet experienced the event (including some individuals who will be censored later).</p>
<p>The <strong>(partial) maximum likelihood</strong> estimates are found by maximizing the <span class="math inline">\(ln (L(\boldsymbol \beta))\)</span> particularly, by taking partial derivatives of <span class="math inline">\(ln (L(\boldsymbol \beta))\)</span> with respect to each parameter in the model, and then solving a system of equations. For this algorithm such as Newton–Raphson <span class="citation">(Ypma <a href="#ref-doi:10.1137/1037125">1995</a>)</span> or Expectation-Maximitazion <span class="citation">(Dempster, Laird, and Rubin <a href="#ref-10.2307/2984875">1977</a>)</span> are used.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<p>In <code>R</code>, we can estimate this model using the <code>coxph</code> function of the <code>survival</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">loan_filtered<span class="op">$</span>LoanOriginalAmount2 &lt;-<span class="st">  </span>loan_filtered<span class="op">$</span>LoanOriginalAmount<span class="op">/</span><span class="dv">10000</span>

model &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>LoanOriginalAmount2 <span class="op">+</span><span class="st"> </span>IsBorrowerHomeowner <span class="op">+</span>
<span class="st">                 </span>IncomeVerifiable, <span class="dt">data =</span> loan_filtered) </code></pre></div>
<p>For taking the <strong>ties</strong> into account we can use the <code>method</code> argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>LoanOriginalAmount2 <span class="op">+</span><span class="st"> </span>IsBorrowerHomeowner <span class="op">+</span>
<span class="st">        </span>IncomeVerifiable, <span class="dt">data =</span> loan_filtered, <span class="dt">method =</span> <span class="st">&quot;efron&quot;</span>) 

<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>LoanOriginalAmount2 <span class="op">+</span><span class="st"> </span>IsBorrowerHomeowner <span class="op">+</span>
<span class="st">        </span>IncomeVerifiable, <span class="dt">data =</span> loan_filtered, <span class="dt">method =</span> <span class="st">&quot;breslow&quot;</span>) 

<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>LoanOriginalAmount2 <span class="op">+</span><span class="st"> </span>IsBorrowerHomeowner <span class="op">+</span>
<span class="st">        </span>IncomeVerifiable, <span class="dt">data =</span> loan_filtered, <span class="dt">method =</span> <span class="st">&quot;exact&quot;</span>) </code></pre></div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-doi:10.1137/1037125">
<p>Ypma, Tjalling J. 1995. “Historical Development of the Newton–Raphson Method.” <em>SIAM Review</em> 37 (4): 531–51. doi:<a href="https://doi.org/10.1137/1037125">10.1137/1037125</a>.</p>
</div>
<div id="ref-10.2307/2984875">
<p>Dempster, A. P., N. M. Laird, and D. B. Rubin. 1977. “Maximum Likelihood from Incomplete Data via the Em Algorithm.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 39 (1). [Royal Statistical Society, Wiley]: 1–38. <a href="http://www.jstor.org/stable/2984875" class="uri">http://www.jstor.org/stable/2984875</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>In the presence of ties, the <span class="citation">Breslow (<a href="#ref-10.2307/1402659">1975</a>)</span> or <span class="citation">Efron (<a href="#ref-doi:10.1080/01621459.1977.10480613">1977</a>)</span> approximations to the log-likelihood can be used.<a href="estimation.html#fnref4">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-semiparametric-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="computing-the-hazard-ratio.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sestelo/sa_financial/edit/master/04_cox_model.Rmd",
"text": "Edit"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
